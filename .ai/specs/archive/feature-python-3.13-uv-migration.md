# Python 3.13 + uv Migration - Feature Specification

> **Дата создания:** 2026-02-13
> **Дата завершения:** 2026-02-13
> **Ветка:** `feature/python-3.13-uv-migration`
> **Статус:** ✅ Завершён
> **Merge commit:** 180c0e1

---

## Workflow выполнения

Данное ТЗ должно выполняться согласно **генеральному workflow** из [CLAUDE.md](../../CLAUDE.md).

### Порядок выполнения для новой фичи

| Шаг | Действие            | Навык                                  | Статус     |
| --- | ------------------- | -------------------------------------- | ---------- |
| а   | Создание ТЗ + Ветка | —                                      | ✅ Завершён |
| б   | Реализация          | `spec-implementer`                     | ✅ Завершён |
| в   | Тестирование        | `gui-testing`                          | ✅ Завершён |
| г   | Мерж                | `merge-helper`                         | ✅ Завершён |

### Текущий статус и следующий шаг

**Текущий шаг:** г (Мерж) — ✅ Завершён
- CHANGELOG обновлён
- Merge в main выполнен
- Spec архивирован

**Workflow завершён.**

---

## Видение

Миграция инфраструктуры проекта на актуальный стек: Python 3.13, uv вместо Poetry, обновлённые библиотеки (включая NumPy 2.x). Это обеспечит актуальность зависимостей, security fixes и новые возможности.

**Ключевые требования:**
- Переход на Python 3.13
- Замена Poetry на uv
- Обновление всех библиотек до актуальных версий
- Удаление Numba (81 функция @njit → pure NumPy)
- Переход на NumPy 2.x
- Сохранение работоспособности (533 теста зелёные)

---

## Анализ совместимости

| Библиотека | Было | Станет | Примечание |
|------------|------|--------|------------|
| Python | 3.12.x | 3.13 | — |
| Package Manager | Poetry | uv | — |
| PyQt6 | ^6.6.1 | ^6.9.0 | — |
| Matplotlib | 3.8.3 (fixed) | ^3.10.0 | Разблокировать |
| NumPy | ^1.26.4 | ^2.2.0 | Breaking changes учтены |
| Pandas | ^2.2.1 | ^2.2.0 | — |
| SciPy | ^1.13.1 | ^1.15.0 | — |
| Numba | ^0.61.0 | ❌ Удалить | 81 функция → pure NumPy |
| Optuna | ^4.1.0 | ^4.2.0 | — |
| Joblib | ^1.4.2 | ^1.4.0 | — |
| PyInstaller | ^6.7.0 | ^6.12.0 | — |
| Pytest | ^8.0.2 | ^8.3.0 | — |
| Ruff | ^0.5.1 | ^0.9.0 | — |
| Black | ^24.8.0 | ^25.1.0 | — |
| Mypy | ^1.8.0 | ^1.15.0 | — |

---

## План реализации

### Этап 1: Python 3.13 + Удаление Numba (~200 строк)
**Статус:** ✅ Завершён

**Цель:** Обновить версию Python и удалить зависимость от Numba

**Задачи:**
- [x] Обновить `requires-python` в pyproject.toml на `>=3.13`
- [x] Удалить `numba = "^0.61.0"` из зависимостей
- [x] Удалить `from numba import njit` из app_settings.py
- [x] Снять декораторы `@njit` с 81 функции в app_settings.py
- [x] Обновить `[tool.ruff] target-version` на `"py313"`
- [x] Обновить `[tool.mypy] python_version` на `"3.13"`

**Файлы:**
- `pyproject.toml` (modify)
- `src/core/app_settings.py` (modify)

**Критерий приёмки:**
- `ruff check src/` — без ошибок
- Все функции работают без numba

---

### Этап 2: Обновление библиотек + NumPy 2.x (~100 строк)
**Статус:** ✅ Завершён

**Цель:** Обновить все зависимости до актуальных версий

**Задачи:**
- [x] Обновить версии всех dependencies в pyproject.toml
- [x] Обновить версии dev-dependencies
- [x] Адаптировать код под NumPy 2.x API changes (если нужно)
- [x] Проверить совместимость SciPy с NumPy 2.x

**Файлы:**
- `pyproject.toml` (modify)
- `src/**/*.py` (modify если есть NumPy 2.x breaking changes)

**Критерий приёмки:**
- `pytest tests/` — все тесты проходят
- `python -m src.gui` — приложение запускается

---

### Этап 3: Миграция Poetry → uv (~80 строк)
**Статус:** ✅ Завершён

**Цель:** Перейти на uv как основной менеджер пакетов

**Задачи:**
- [x] Переписать pyproject.toml в формат uv (PEP 621)
- [x] Создать `.python-version` с содержимым `3.13`
- [x] Удалить секции `[tool.poetry.*]`
- [x] Добавить секцию `[project]` с metadata
- [x] Добавить секцию `[dependency-groups]` для dev deps
- [x] Удалить `poetry.lock` (будет заменён на `uv.lock`)
- [x] Обновить `[build-system]` на hatchling или flit

**Файлы:**
- `pyproject.toml` (rewrite)
- `.python-version` (create)
- `poetry.lock` (delete)

**Критерий приёмки:**
- `uv sync` — успешно создаёт venv и install
- `uv run pytest tests/` — все тесты проходят
- `uv run python -m src.gui` — приложение запускается

---

## Итоговые критерии приёмки

| Критерий | Команда | Ожидаемый результат |
|----------|---------|---------------------|
| Тесты | `pytest tests/` | 533 passed |
| Lint | `ruff check src/` | No errors |
| Type check | `mypy src/` | No errors |
| GUI | `python -m src.gui` | Приложение запускается |
| Sync | `uv sync` | Успешная установка |

---

## История изменений

| Дата       | Этап | Коммит | Описание               |
| ---------- | ---- | ------ | ---------------------- |
| 2026-02-13 | —    | 9de69bf | ТЗ создано             |
| 2026-02-13 | 1    | de7b557 | Python 3.13 + удаление Numba |
| 2026-02-13 | 2    | 6dfb4d3 | Обновление библиотек + NumPy 2.x |
| 2026-02-13 | 3    | a796de6 | Миграция Poetry → uv |
| 2026-02-13 | fix  | 24c76d2 | Исправление импортов для uv |
| 2026-02-13 | docs | 3e09714 | CHANGELOG + spec update |
| 2026-02-13 | MERGE | 180c0e1 | Feature merged to main |
