# Переработка конфигурации Claude (CLAUDE.md, .ai, .claude) - Feature Specification

> **Дата создания:** 2026-02-13
> **Дата завершения:** 2026-02-13
> **Ветка:** `feature/claude-integration`
> **Статус:** ✅ Завершён
> **Коммит:** -

---

## Workflow выполнения

Данное ТЗ должно выполняться согласно **генеральному workflow** из [CLAUDE.md](../../CLAUDE.md).

### Порядок выполнения для новой фичи

| Шаг | Действие            | Навык                                  | Статус     |
| --- | ------------------- | -------------------------------------- | ---------- |
| а   | Создание ТЗ + Ветка | —                                      | ✅ Завершён |
| б   | Реализация          | `spec-implementer` или `parallel-mode` | ❌ Не начат |
| в   | Тестирование        | `gui-testing`                          | ❌ Не начат |
| г   | Мерж                | `merge-helper`                         | ❌ Не начат |

### Текущий статус и следующий шаг

**Текущий шаг:** а (Создание ТЗ + Ветка) — ✅ Завершён
- Ветка: `feature/claude-integration`

**Следующий шаг:** б (Реализация)
- Выполнить через навык `spec-implementer`

---

## Видение

Переработать конфигурацию Claude Code для соответствия реальной архитектуре проекта **solid-state_kinetics** — desktop GUI приложения на PyQt6 для анализа кинетики твердофазных реакций.

**Проблема:** Текущий CLAUDE.md описывает web_portal (FastAPI), что не соответствует реальному проекту. Навыки и документация не адаптированы под desktop научное ПО.

**Цель:** Создать актуальную конфигурацию, отражающую:
- Модульную сигнально-управляемую архитектуру PyQt6
- Научные вычисления (кинетический анализ, деконволюция)
- Структуру данных для экспериментальных результатов

**Ключевые требования:**
- Сохранить workflow схему (spec-creation → spec-implementer → testing → merge)
- Заменить web-portal-testing на gui-testing (pytest + pytest-qt)
- Расширить структуру .ai/: ARCHITECTURE.md, UI_ARCHITECTURE.md, DATA_MODELS.md, TESTING.md
- Сохранить коммит-лимит ≤250 строк

---

## План реализации

### Этап 1: Анализ проекта и обновление CLAUDE.md (~200 строк)
**Статус:** ✅ Завершён

**Цель:** Исследовать текущую структуру проекта и создать базовый CLAUDE.md, отражающий реальную архитектуру.

**Задачи:**
- [x] Проанализировать структуру `src/gui/` и `src/core/`
- [x] Определить ключевые модули и их взаимодействие
- [x] Описать технологический стек (PyQt6, Matplotlib, NumPy, SciPy)
- [x] Переписать секцию "Структура приложения" в CLAUDE.md
- [x] Обновить таблицу навыков (web-portal-testing → gui-testing)
- [x] Сохранить workflow диаграмму и правила переходов

**Файлы:**
- `CLAUDE.md` (modify)

**Критерий приёмки:**
- CLAUDE.md описывает PyQt6 приложение, а не web_portal
- Workflow схема сохранена с адаптацией под gui-testing

---

### Этап 2: Архитектурная документация (.ai/) (~800 строк)
**Статус:** ✅ Завершён

**Цель:** Создать полную архитектурную документацию на основе анализа кода.

**Задачи:**
- [x] Создать `.ai/ARCHITECTURE.md` — архитектура приложения
  - BaseSignals/BaseSlots система коммуникации
  - Request-Response паттерн
  - Модули расчётов (model-fit, model-free, model-based)
- [x] Создать `.ai/UI_ARCHITECTURE.md` — архитектура GUI
  - MainWindow, вкладки, панели
  - Сигнально-слотовые связи
  - Интерактивная визуализация (matplotlib + anchors)
- [x] Создать `.ai/DATA_MODELS.md` — структуры данных
  - FileData (экспериментальные данные)
  - CalculationsData (конфигурации реакций)
  - SeriesData (серии экспериментов)
  - path_keys система доступа

**Файлы:**
- `.ai/ARCHITECTURE.md` (create)
- `.ai/UI_ARCHITECTURE.md` (create)
- `.ai/DATA_MODELS.md` (create)

**Критерий приёмки:**
- Документация соответствует реальному коду
- Примеры кода с указанием путей (file:line)

---

### Этап 3: Исследование и настройка тестирования (~300 строк)
**Статус:** ✅ Завершён

**Цель:** Исследовать лучшие практики тестирования PyQt6 приложений и создать соответствующую документацию и навык.

**Задачи:**
- [x] Web-поиск: MCP сервера для PyQt тестирования
- [x] Web-поиск: pytest-qt лучшие практики 2025-2026
- [x] Web-поиск: автоматизированное тестирование научного ПО
- [x] Сравнить подходы:
  - pytest-qt (классический) — ✅ выбран
  - pytest-qt + pytest-xvfb (headless Linux) — ✅ для CI/CD
  - Playwright для desktop — ❌ не подходит (только для браузеров)
  - MCP-based решения — ❌ нет готовых для PyQt
- [x] Создать `.ai/TESTING.md` с выбранным подходом (отменено — не требуется)
- [x] Адаптировать навык `web-portal-testing` → `gui-testing`
  - Переименовать директорию
  - Обновить SKILL.md под pytest + pytest-qt
  - Создать примеры тестов

**Файлы:**
- `.claude/skills/web-portal-testing/` → `.claude/skills/gui-testing/` (rename + modify) ✅
- `.claude/skills/gui-testing/SKILL.md` (create) ✅
- `.claude/skills/gui-testing/references/pytest-qt-patterns.md` (create) ✅

**Критерий приёмки:**
- Обоснованный выбор технологии тестирования ✅
- Работающий навык gui-testing ✅
- Пример теста для одного из модулей ✅

---

### Этап 4: Обновление служебных навыков (~150 строк)
**Статус:** ✅ Завершён

**Цель:** Адаптировать служебные навыки под desktop приложение.

**Задачи:**
- [x] Проверить `spec-implementer` на соответствие PyQt архитектуре
- [x] Обновить `commit-helper` если нужны изменения
- [x] Обновить `merge-helper` если нужны изменения
- [x] Удалить `parallel-mode` из проекта

**Файлы:**
- `.claude/skills/spec-implementer/SKILL.md` (review, modify if needed)
- `.claude/skills/commit-helper/SKILL.md` (review, modify if needed)
- `.claude/skills/merge-helper/SKILL.md` (review, modify if needed)

**Критерий приёмки:**
- Все навыки корректно работают с PyQt проектом
- Нет ссылок на web_portal или FastAPI

---

### Этап 5: CHANGELOG и финализация (~50 строк)
**Статус:** ✅ Завершён

**Цель:** Обновить CHANGELOG и убедиться в полноте переработки.

**Задачи:**
- [x] Обновить `.ai/CHANGELOG.md` с записью о переработке конфигурации
- [x] Проверить все ссылки в CLAUDE.md
- [x] Удалить `.github/instructions/` или оставить с пометкой об устаревании — оставлены (актуальны)

**Файлы:**
- `.ai/CHANGELOG.md` (modify)
- `.github/instructions/` (review, decide on removal)

**Критерий приёмки:**
- CHANGELOG содержит запись о переработке
- Все ссылки валидны

---

## История изменений

| Дата       | Этап | Коммит | Описание                          |
| ---------- | ---- | ------ | --------------------------------- |
| 2026-02-13 | 1    | 9c78953 | Анализ проекта, обновление CLAUDE.md |
| 2026-02-13 | 2    | fbe7471 | Создана архитектурная документация (ARCHITECTURE.md, UI_ARCHITECTURE.md, DATA_MODELS.md) |
| 2026-02-13 | 3    | f2858e8 | Исследование тестирования, создание gui-testing навыка |
| 2026-02-13 | 4    | 129b9ad | Обновление служебных навыков, удаление parallel-mode |
| 2026-02-13 | 5    | e1ea2ce | CHANGELOG и финализация |
| 2026-02-13 | MERGE | -      | Feature merged to main |
| 2026-02-13 | -    | -      | ТЗ создано                        |
